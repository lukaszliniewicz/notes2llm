<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notes2LLM Prompt Generator</title>
    <style>
        body {
            font-family: sans-serif;
            line-height: 1.6;
            margin: 20px;
            background-color: #f4f4f4;
            color: #384D68;
        }

        .prompt-gen-container {
            max-width: 800px;
            margin: auto;
            background: #fff;
            padding: 20px;
            border: 1px solid #ddd;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        
        .description {
            text-align: center;
            margin-bottom: 25px;
            color: #555;
            font-style: italic;
        }

        fieldset {
            border: 1px solid #ccc;
            padding: 15px;
            margin-bottom: 20px;
            background-color: #f9f9f9;
        }

        legend {
            font-weight: bold;
            padding: 0 10px;
            color: #384D68;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input[type="text"],
        input[type="url"],
        input[type="number"],
        select,
        textarea,
        input[type="file"] {
            width: calc(100% - 22px);
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            box-sizing: border-box;
        }

        input[type="color"] {
            width: 60px;
            height: 40px;
            padding: 0;
            border: 1px solid #ddd;
            cursor: pointer;
            vertical-align: middle;
        }

        .prompt-gen-color-picker-container {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .prompt-gen-color-picker-container label {
            margin-right: 10px;
            margin-bottom: 0;
            width: 200px;
        }

        .prompt-gen-color-value {
            margin-left: 10px;
            font-family: monospace;
        }

        textarea {
            min-height: 100px; /* Default min-height for textareas */
            resize: vertical;
        }
        
        #prompt-gen-summary {
            min-height: 80px;
        }
        #prompt-gen-additional-style {
            min-height: 120px; 
        }
        #prompt-gen-content-instructions {
            min-height: 180px;
        }


        input[type="radio"],
        input[type="checkbox"] {
            margin-right: 5px;
            vertical-align: middle; 
        }

        .prompt-gen-radio-group label,
        .prompt-gen-checkbox-group label {
            font-weight: normal;
            display: inline-block;
            margin-right: 15px;
            margin-bottom: 5px; 
        }
        
        .prompt-gen-inline-label {
            display: inline-block !important;
            font-weight: normal !important;
            margin-left: 5px;
        }

        button {
            display: block;
            width: 100%;
            padding: 12px;
            background-color: #ffffff;
            color: #384D68;
            border: 1px solid #384D68;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        button:hover {
            background-color: #384D68;
            color: white;
        }

        #prompt-gen-output {
            margin-top: 20px;
            padding: 15px;
            background: #eef;
            border: 1px solid #cce;
            white-space: pre-wrap; 
            word-wrap: break-word;
            font-family: monospace;
        }

        .prompt-gen-hidden {
            display: none !important; /* Added important to ensure override */
        }

        .prompt-gen-sub-options {
            margin-left: 20px;
            padding-left: 15px;
            border-left: 2px solid #eee;
            margin-top: 10px;
        }
        
        .prompt-gen-field-note {
            font-size: 0.9em;
            color: #777;
            margin-bottom: 10px;
            font-style: italic; 
        }
        
        .prompt-gen-nested-sub-options {
            margin-left: 15px;
            padding-left: 10px;
            border-left: 1px solid #eee;
            margin-top: 5px;
        }
        
        .prompt-gen-copy-button {
            display: inline-block;
            width: auto;
            padding: 5px 10px;
            margin-left: 10px;
            font-size: 14px;
        }
        
        .prompt-gen-output-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .prompt-gen-tip-frame {
            border: 1px solid #4CAF50;
            background-color: #e8f5e9;
            padding: 10px 15px;
            margin-top: 8px;
            margin-bottom: 15px;
            border-radius: 4px;
        }
        .prompt-gen-tip-frame p.prompt-gen-field-note {
            margin: 0;
            color: #1b5e20;
            font-style: normal; 
        }

        .prompt-gen-other-style-text {
            display: none; 
            width: 250px; 
            margin-left: 5px;
            vertical-align: baseline;
            padding: 8px; 
            margin-bottom: 5px; 
        }
        h3.section-sub-heading {
            margin-top: 20px;
            margin-bottom: 10px;
            color: #384D68;
            font-size: 1.1em;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
    </style>
</head><body>
    <div class="prompt-gen-container">
        <!-- H1 removed as requested -->
        <p class="description">
            This tool helps you compose effective prompts for Large Language Models (LLMs) to generate high-quality code 
            with specific styling and functionality. The resulting code can be used directly or further refined in 
            Notes2LLM to streamline your workflow and achieve consistent, precise results from AI models. You can save your current selections as a JSON profile and load profiles to quickly prefill the form.
        </p>

        <form id="prompt-gen-form">
            <!-- PURPOSE -->
            <fieldset>
                <legend>Purpose</legend>
                <label for="prompt-gen-purpose">What kind of code would you like to generate?</label>
                <select id="prompt-gen-purpose" name="purpose">
                    <option value="html_css_js" selected>HTML/CSS/JS (General)</option>
                    <option value="wordpress">Wordpress Element</option>
                    <option value="email">Email</option>
                    <option value="full_website">Full Website</option>
                    <option value="web_app">Full Web App</option>
                    <option value="web_page">Web Page for Existing Site</option>
                </select>

                <div id="prompt-gen-wordpress-options" class="prompt-gen-sub-options prompt-gen-hidden">
                    <label for="prompt-gen-wordpress-type">Wordpress Element Type:</label>
                    <select id="prompt-gen-wordpress-type" name="wordpressType">
                        <option value="homepage">Homepage Section</option>
                        <option value="post">Post Content Element</option>
                        <option value="page">Page Content Element</option>
                        <option value="page_element">Specific Page Element (e.g., widget)</option>
                    </select>
                </div>

                <div id="prompt-gen-email-options" class="prompt-gen-sub-options prompt-gen-hidden">
                    <label for="prompt-gen-email-type">Email Type:</label>
                    <select id="prompt-gen-email-type" name="emailType">
                        <option value="regular">Regular Email</option>
                        <option value="newsletter">Newsletter</option>
                        <option value="signature">Email Signature</option>
                    </select>
                </div>
                
                <label for="prompt-gen-summary" style="margin-top:15px;">Summarize what you want to create:</label>
                <textarea id="prompt-gen-summary" name="summary" placeholder="e.g., "A Wordpress post about Pandas" or "A website for my company", or "An email signature for work""></textarea>

            </fieldset>

            <!-- STYLING -->
            <fieldset>
                <legend>Styling</legend>

                <div>
                    <label>General Style Instructions:</label>
                    <div class="prompt-gen-radio-group">
                        <input type="radio" id="prompt-gen-style-modern" name="generalStyle" value="modern" checked>
                        <label for="prompt-gen-style-modern">Modern</label>
                        <input type="radio" id="prompt-gen-style-retro" name="generalStyle" value="retro">
                        <label for="prompt-gen-style-retro">Retro</label>
                        <input type="radio" id="prompt-gen-style-striking" name="generalStyle" value="visually_striking">
                        <label for="prompt-gen-style-striking">Visually Striking</label>
                        <input type="radio" id="prompt-gen-style-professional" name="generalStyle" value="professional">
                        <label for="prompt-gen-style-professional">Professional</label><br>
                        <input type="radio" id="prompt-gen-style-other" name="generalStyle" value="other">
                        <label for="prompt-gen-style-other">Other:</label>
                        <input type="text" id="prompt-gen-style-other-text" name="generalStyleOtherText" placeholder="Specify other style" class="prompt-gen-other-style-text">
                    </div>
                </div>

                <div>
                    <label for="prompt-gen-additional-style">Additional Style Instructions:</label>
                    <textarea id="prompt-gen-additional-style" name="additionalStyle"></textarea>
                </div>
                
                <div>
                    <label for="prompt-gen-reference-code">Reference Code (Optional):</label>
                    <p class="prompt-gen-field-note">Paste reference code here (e.g., a code snippet from your site, or the full 'View Source' output of a page). If 'View Source' is pasted, we will attempt to extract the main body content and internal CSS styles as a reference for the AI. Any pasted code will be given to the model as style reference.</p>
                    <div class="prompt-gen-tip-frame">
                        <p class="prompt-gen-field-note">Tip: You can also make a screenshot of the page or element you want to use as a reference and upload it to the LLM (Claude, ChatGPT, and Gemini all accept images as input).</p>
                    </div>
                    <textarea id="prompt-gen-reference-code" name="referenceCode" placeholder="Paste HTML/CSS here..."></textarea>
                </div>

                <h3 class="section-sub-heading">Colors & Fonts</h3>
                
                <div>
                    <input type="checkbox" id="prompt-gen-define-color" name="defineColor">
                    <label for="prompt-gen-define-color" class="prompt-gen-inline-label">Define Colors?</label>
                </div>
                <div id="prompt-gen-color-options" class="prompt-gen-sub-options prompt-gen-hidden">
                    <label>Color Palette:</label>
                    <div class="prompt-gen-radio-group">
                        <input type="radio" id="prompt-gen-model-palette" name="paletteChoice" value="model_generates" checked>
                        <label for="prompt-gen-model-palette">Let the model generate a palette from a single color:</label>
                        <div class="prompt-gen-color-picker-container">
                            <input type="color" id="prompt-gen-single-color-for-palette" name="singleColorForPalette" value="#384D68">
                            <span id="prompt-gen-single-color-value" class="prompt-gen-color-value">#384D68</span>
                        </div>
                    </div>
                    <div class="prompt-gen-radio-group">
                        <input type="radio" id="prompt-gen-manual-palette" name="paletteChoice" value="manual">
                        <label for="prompt-gen-manual-palette">Define manually:</label>
                    </div>
                    <div id="prompt-gen-manual-color-inputs" class="prompt-gen-sub-options">
                        <div class="prompt-gen-color-picker-container">
                            <label for="prompt-gen-main-accent-color">Main Accent Color:</label>
                            <input type="color" id="prompt-gen-main-accent-color" name="mainAccentColor" value="#384D68" disabled>
                            <span id="prompt-gen-main-accent-value" class="prompt-gen-color-value">#384D68</span>
                        </div>
                        <div class="prompt-gen-color-picker-container">
                            <label for="prompt-gen-secondary-accent-color">Secondary Accent Color:</label>
                            <input type="color" id="prompt-gen-secondary-accent-color" name="secondaryAccentColor" value="#2ecc71" disabled>
                            <span id="prompt-gen-secondary-accent-value" class="prompt-gen-color-value">#2ecc71</span>
                        </div>
                        <div class="prompt-gen-color-picker-container">
                            <label for="prompt-gen-text-color">Text Color:</label>
                            <input type="color" id="prompt-gen-text-color" name="textColor" value="#384D68" disabled>
                            <span id="prompt-gen-text-color-value" class="prompt-gen-color-value">#384D68</span>
                        </div>
                    </div>
                </div>

                <div>
                    <input type="checkbox" id="prompt-gen-define-font" name="defineFont">
                    <label for="prompt-gen-define-font" class="prompt-gen-inline-label">Define Fonts?</label>
                </div>
                <div id="prompt-gen-font-options" class="prompt-gen-sub-options prompt-gen-hidden">
                    <label>Font:</label>
                    <select id="prompt-gen-font-choice" name="fontChoice">
                        <option value="standard">Standard Web Fonts (e.g., Arial, Verdana)</option>
                        <option value="google">Google Fonts</option>
                    </select>
                    <div id="prompt-gen-google-font-options" class="prompt-gen-sub-options prompt-gen-hidden">
                        <label for="prompt-gen-google-font-name">Google Font Name(s) (comma-separated):</label>
                        <input type="text" id="prompt-gen-google-font-name" name="googleFontName" placeholder="e.g., Roboto, Open Sans">
                        <input type="checkbox" id="prompt-gen-include-google-font-import" name="includeGoogleFontImport" checked>
                        <label for="prompt-gen-include-google-font-import" class="prompt-gen-inline-label">Ask model to include font import code</label>
                    </div>
                    <div>
                        <input type="checkbox" id="prompt-gen-allow-font-awesome" name="allowFontAwesome" checked>
                        <label for="prompt-gen-allow-font-awesome" class="prompt-gen-inline-label">Allow Font Awesome icons</label>
                    </div>
                    <div id="prompt-gen-font-awesome-import-option" class="prompt-gen-sub-options">
                        <input type="checkbox" id="prompt-gen-import-font-awesome" name="importFontAwesome" checked>
                        <label for="prompt-gen-import-font-awesome" class="prompt-gen-inline-label">Import Font Awesome (if used)</label>
                    </div>
                </div>
            </fieldset>

            <!-- COMPOSITION / ELEMENTS -->
            <fieldset>
                <legend>Composition / Elements (Optional)</legend>
                <div class="prompt-gen-tip-frame">
                    <p class="prompt-gen-field-note">
                        These options are here to help you with ideas and structuring elements (like photo links, headers, etc.).
                        This section can be safely ignored, and all structural or content requirements can be described in the "Content Instructions" section below.
                    </p>
                </div>

                <div id="prompt-gen-header-section">
                    <label for="prompt-gen-header-type">Include Header / Hero Section / Title:</label>
                    <select id="prompt-gen-header-type" name="headerType">
                        <option value="no" selected>No</option>
                        <option value="title_only">Title Only</option>
                        <option value="simple_header">Simple Header</option>
                        <option value="hero_image">Hero Section with Image</option>
                    </select>
                </div>
                <div id="prompt-gen-header-image-options" class="prompt-gen-sub-options prompt-gen-hidden">
                    <label>Image Source:</label>
                    <div class="prompt-gen-radio-group">
                        <input type="radio" id="prompt-gen-image-placeholder" name="imageSource" value="placeholder" checked>
                        <label for="prompt-gen-image-placeholder">Use Placeholder</label>
                        <input type="radio" id="prompt-gen-image-url" name="imageSource" value="url">
                        <label for="prompt-gen-image-url">Provide Image URL</label>
                    </div>
                    <input type="url" id="prompt-gen-header-image-url-input" name="headerImageUrlInput" placeholder="https://example.com/image.jpg" class="prompt-gen-hidden">
                </div>
                
                <!-- Logo Options (conditionally shown) -->
                <div id="prompt-gen-logo-options-container" class="prompt-gen-hidden">
                    <label>Include Logo:</label>
                    <div class="prompt-gen-radio-group">
                        <input type="radio" id="prompt-gen-logo-no" name="logoChoice" value="no" checked>
                        <label for="prompt-gen-logo-no">No</label>
                        <input type="radio" id="prompt-gen-logo-placeholder" name="logoChoice" value="placeholder">
                        <label for="prompt-gen-logo-placeholder">Use Placeholder Logo</label>
                        <input type="radio" id="prompt-gen-logo-url" name="logoChoice" value="url">
                        <label for="prompt-gen-logo-url">Provide Logo URL</label>
                    </div>
                    <input type="url" id="prompt-gen-logo-url-input" name="logoUrlInput" placeholder="https://example.com/logo.png" class="prompt-gen-hidden">
                </div>

                <!-- Site Menu Options (conditionally shown for full website/web app) -->
                <div id="prompt-gen-site-menu-options-container" class="prompt-gen-hidden">
                    <label for="prompt-gen-site-menu-type">Main Navigation Menu Style:</label>
                    <select id="prompt-gen-site-menu-type" name="siteMenuType">
                        <option value="none" selected>None / Not specified</option>
                        <option value="top_horizontal">Top Horizontal Menu</option>
                        <option value="sidebar_left">Sidebar Menu (Left)</option>
                        <option value="sidebar_right">Sidebar Menu (Right)</option>
                        <option value="hamburger">Hamburger Menu (for mobile-first or minimalist sites)</option>
                    </select>
                    <label for="prompt-gen-site-menu-instructions">Additional Menu Instructions:</label>
                    <textarea id="prompt-gen-site-menu-instructions" name="siteMenuInstructions" placeholder="e.g., Menu items (Home, About, Services, Contact), dropdowns, sticky behavior..."></textarea>
                </div>

                <div id="prompt-gen-internal-menu-container" class="prompt-gen-hidden">
                    <label for="prompt-gen-toc-type">Include Internal Menu / TOC (based on heading IDs):</label>
                    <select id="prompt-gen-toc-type" name="tocType">
                        <option value="no" selected>No</option>
                        <option value="top">On Top</option>
                        <option value="top_scrolling">On Top (Scrolling with Page)</option>
                        <option value="floating_left">Floating Widget on Left</option>
                    </select>
                </div>

                <div id="prompt-gen-pictures-section">
                    <input type="checkbox" id="prompt-gen-include-pictures" name="includePictures">
                    <label for="prompt-gen-include-pictures" class="prompt-gen-inline-label">Include Pictures?</label>
                </div>
                <div id="prompt-gen-pictures-options" class="prompt-gen-sub-options prompt-gen-hidden">
                    <label>Picture Source:</label>
                    <div class="prompt-gen-radio-group">
                        <input type="radio" id="prompt-gen-pictures-placeholder" name="picturesSource" value="placeholder" checked>
                        <label for="prompt-gen-pictures-placeholder">Use Placeholders</label>
                        <input type="radio" id="prompt-gen-pictures-url" name="picturesSource" value="url">
                        <label for="prompt-gen-pictures-url">Provide Image URLs</label>
                    </div>
                    
                    <div id="prompt-gen-pictures-placeholder-options" class="prompt-gen-sub-options">
                        <label for="prompt-gen-pictures-placeholder-count">Number of placeholders:</label>
                        <input type="number" id="prompt-gen-pictures-placeholder-count" name="picturesPlaceholderCount" min="1" value="3">
                    </div>
                    
                    <div id="prompt-gen-pictures-url-options" class="prompt-gen-sub-options prompt-gen-hidden">
                        <label for="prompt-gen-pictures-urls">Image URLs (one per line):</label>
                        <textarea id="prompt-gen-pictures-urls" name="picturesUrls" placeholder="https://example.com/image1.jpg
https://example.com/image2.jpg"></textarea>
                    </div>
                    
                    <label>Display Method:</label>
                    <div class="prompt-gen-radio-group">
                        <input type="radio" id="prompt-gen-pictures-as-is" name="picturesDisplayMethod" value="as_is" checked>
                        <label for="prompt-gen-pictures-as-is">Add as regular images</label>
                        <input type="radio" id="prompt-gen-pictures-background" name="picturesDisplayMethod" value="background">
                        <label for="prompt-gen-pictures-background">Use as background in styled frames</label>
                    </div>
                    
                    <div>
                        <input type="checkbox" id="prompt-gen-pictures-lightbox" name="picturesLightbox">
                        <label for="prompt-gen-pictures-lightbox" class="prompt-gen-inline-label">Include lightbox functionality</label>
                        <p class="prompt-gen-field-note prompt-gen-hidden" id="prompt-gen-lightbox-wp-note">Note: Generally not needed for WordPress as it has built-in lightbox functionality.</p>
                    </div>
                </div>

                <div id="prompt-gen-slider-section">
                    <input type="checkbox" id="prompt-gen-include-slider" name="includeSlider">
                    <label for="prompt-gen-include-slider" class="prompt-gen-inline-label">Include a Slider?</label>
                </div>
                <div id="prompt-gen-slider-options" class="prompt-gen-sub-options prompt-gen-hidden">
                    <label for="prompt-gen-slider-type">Slider Type:</label>
                    <select id="prompt-gen-slider-type" name="sliderType">
                        <option value="basic_fade">Basic Fade Transition</option>
                        <option value="basic_slide">Basic Slide Transition</option>
                        <option value="carousel_multiple">Carousel (shows multiple items)</option>
                        <option value="full_width_hero">Full-width Hero Slider</option>
                    </select>
                    
                    <label>Slider Content:</label>
                    <div class="prompt-gen-radio-group">
                        <input type="radio" id="prompt-gen-slider-placeholder" name="sliderContentSource" value="placeholder" checked>
                        <label for="prompt-gen-slider-placeholder">Use Placeholders</label>
                        <input type="radio" id="prompt-gen-slider-url" name="sliderContentSource" value="url">
                        <label for="prompt-gen-slider-url">Provide Image URLs</label>
                    </div>
                    
                    <div id="prompt-gen-slider-placeholder-options" class="prompt-gen-sub-options">
                        <label for="prompt-gen-slider-placeholder-count">Number of slides:</label>
                        <input type="number" id="prompt-gen-slider-placeholder-count" name="sliderPlaceholderCount" min="1" value="3">
                    </div>
                    
                    <div id="prompt-gen-slider-url-options" class="prompt-gen-sub-options prompt-gen-hidden">
                        <label for="prompt-gen-slider-urls">Slide Image URLs (one per line):</label>
                        <textarea id="prompt-gen-slider-urls" name="sliderUrls" placeholder="https://example.com/slide1.jpg
https://example.com/slide2.jpg"></textarea>
                    </div>
                    
                    <label for="prompt-gen-slider-instructions">Additional Slider Instructions:</label>
                    <textarea id="prompt-gen-slider-instructions" name="sliderInstructions" placeholder="e.g., Autoplay speed, navigation controls, captions..."></textarea>
                </div>
                
                <div id="prompt-gen-gallery-section">
                    <input type="checkbox" id="prompt-gen-include-gallery" name="includeGallery">
                    <label for="prompt-gen-include-gallery" class="prompt-gen-inline-label">Include a Photo Gallery?</label>
                </div>
                <div id="prompt-gen-gallery-options" class="prompt-gen-sub-options prompt-gen-hidden">
                    <label for="prompt-gen-gallery-type">Gallery Type:</label>
                    <select id="prompt-gen-gallery-type" name="galleryType">
                        <option value="grid">Grid Layout</option>
                        <option value="masonry">Masonry Layout</option>
                        <option value="lightbox">Lightbox Gallery (clickable thumbnails)</option>
                    </select>
                    
                    <label>Gallery Content:</label>
                    <div class="prompt-gen-radio-group">
                        <input type="radio" id="prompt-gen-gallery-placeholder" name="galleryContentSource" value="placeholder" checked>
                        <label for="prompt-gen-gallery-placeholder">Use Placeholders</label>
                        <input type="radio" id="prompt-gen-gallery-url" name="galleryContentSource" value="url">
                        <label for="prompt-gen-gallery-url">Provide Image URLs</label>
                    </div>
                    
                    <div id="prompt-gen-gallery-placeholder-options" class="prompt-gen-sub-options">
                        <label for="prompt-gen-gallery-placeholder-count">Number of images:</label>
                        <input type="number" id="prompt-gen-gallery-placeholder-count" name="galleryPlaceholderCount" min="1" value="6">
                    </div>
                    
                    <div id="prompt-gen-gallery-url-options" class="prompt-gen-sub-options prompt-gen-hidden">
                        <label for="prompt-gen-gallery-urls">Gallery Image URLs (one per line):</label>
                        <textarea id="prompt-gen-gallery-urls" name="galleryUrls" placeholder="https://example.com/gallery1.jpg
https://example.com/gallery2.jpg"></textarea>
                    </div>
                    
                    <label for="prompt-gen-gallery-instructions">Additional Gallery Instructions:</label>
                    <textarea id="prompt-gen-gallery-instructions" name="galleryInstructions" placeholder="e.g., Number of columns, hover effects, captions..."></textarea>
                </div>

                <div id="prompt-gen-list-formatting-section">
                    <label for="prompt-gen-list-format">Lists Formatting:</label>
                    <select id="prompt-gen-list-format" name="listFormat">
                        <option value="default">Default Browser Styling</option>
                        <option value="cards_tiles">Format as Cards/Tiles</option>
                        <option value="simple_styled">Simple Custom Styling</option>
                        <option value="stylish">Stylish Custom Formatting</option>
                    </select>
                    <div class="prompt-gen-sub-options">
                        <label for="prompt-gen-list-custom-instructions">Custom List Instructions:</label>
                        <input type="text" id="prompt-gen-list-custom-instructions" name="listCustomInstructions" placeholder="e.g., Icon per list item, specific card design">
                    </div>
                </div>
            </fieldset>

            <!-- CONTENT -->
            <fieldset>
                <legend>Content</legend>
                <label for="prompt-gen-content-instructions">Content Instructions & Main Text:</label>
                <p class="prompt-gen-field-note">
                    Provide the text or bullet points for your content here. It's helpful to specify a structure, such as:
                    which text should be a heading (and what level: H1, H2, etc.), which parts form distinct sections, 
                    or what items should appear in a menu if you're designing a full page or site. 
                    These instructions will take precedence if they conflict with earlier settings.
                </p>
                <textarea id="prompt-gen-content-instructions" name="contentInstructions" placeholder="Example for a panda website:
Homepage:
- Hero section with a large image of a panda and a catchy tagline like 'Pandas: Nature's Adorable Ambassadors'.
- Section 'About Pandas': Brief intro, physical characteristics, diet (bamboo focus).
- Section 'Panda Habitats': Where they live, map integration idea.
- Section 'Conservation Efforts': What's being done to protect them. Call to action to donate.
- Footer: Copyright and social media links.

Menu Items: Home, About, Habitats, Conservation, Contact Us.

Content for About Page:
- Detailed information about Giant Pandas and Red Pandas.
- Lifecycle.
- Threats.
..."></textarea>

                <label>Text Treatment:</label>
                <div class="prompt-gen-radio-group">
                    <input type="radio" id="prompt-gen-text-do-not-specify" name="textTreatment" value="do_not_specify" checked>
                    <label for="prompt-gen-text-do-not-specify">Do not specify</label><br>
                    <input type="radio" id="prompt-gen-text-preserve" name="textTreatment" value="preserve">
                    <label for="prompt-gen-text-preserve">Preserve my text verbatim</label><br>
                    <input type="radio" id="prompt-gen-text-improve-mistakes" name="textTreatment" value="improve_mistakes">
                    <label for="prompt-gen-text-improve-mistakes">Improve obvious mistakes</label><br>
                    <input type="radio" id="prompt-gen-text-improve-styling" name="textTreatment" value="improve_styling">
                    <label for="prompt-gen-text-improve-styling">Improve styling (rewrites for tone/flow)</label><br>
                </div>
                <div id="prompt-gen-text-style-options" class="prompt-gen-sub-options prompt-gen-hidden">
                    <label for="prompt-gen-text-style-tone">Text Style/Tone Instructions:</label>
                    <select id="prompt-gen-text-style-tone" name="textStyleTone">
                        <option value="professional">Professional</option>
                        <option value="semi_professional">Semi-Professional</option>
                        <option value="casual">Casual</option>
                        <option value="semi_casual">Semi-Casual</option>
                        <option value="warm">Warm</option>
                        <option value="factual">Factual</option>
                        <option value="informative">Informative</option>
                        <option value="intimate">Intimate</option>
                    </select>
                    <label for="prompt-gen-text-style-reference">Text Style Reference (Optional):</label>
                    <p class="prompt-gen-field-note">Paste a text fragment for style reference (content will be ignored).</p>
                    <textarea id="prompt-gen-text-style-reference" name="textStyleReference" placeholder="Paste reference text here..."></textarea>
                </div>
                
                <div id="prompt-gen-additional-text-instructions-container" class="prompt-gen-sub-options prompt-gen-hidden">
                    <label for="prompt-gen-additional-text-instructions">Additional Text Treatment Instructions:</label>
                    <textarea id="prompt-gen-additional-text-instructions" name="additionalTextInstructions" placeholder="Add any specific instructions for text formatting, voice, tone, or special handling not covered by the options above."></textarea>
                </div>
            </fieldset>
            
            <!-- RESPONSIVENESS AND ACCESSIBILITY -->
            <fieldset>
                <legend>Responsiveness and Accessibility</legend>
                <div>
                    <input type="checkbox" id="prompt-gen-mobile-first" name="mobileFirst">
                    <label for="prompt-gen-mobile-first" class="prompt-gen-inline-label">Mobile-First Design</label>
                </div>
                <div>
                    <input type="checkbox" id="prompt-gen-include-dark-mode" name="includeDarkMode">
                    <label for="prompt-gen-include-dark-mode" class="prompt-gen-inline-label">Include Dark Mode with system preference detection</label>
                </div>
                <div>
                    <input type="checkbox" id="prompt-gen-include-high-contrast" name="includeHighContrast">
                    <label for="prompt-gen-include-high-contrast" class="prompt-gen-inline-label">Include High Contrast Mode option</label>
                </div>
                <div>
                    <input type="checkbox" id="prompt-gen-include-font-sizing" name="includeFontSizing">
                    <label for="prompt-gen-include-font-sizing" class="prompt-gen-inline-label">Include Font Size adjustment controls</label>
                </div>
                <div>
                    <input type="checkbox" id="prompt-gen-ensure-aria" name="ensureAria">
                    <label for="prompt-gen-ensure-aria" class="prompt-gen-inline-label">Ensure ARIA attributes for accessibility</label>
                </div>
                <div>
                    <label for="prompt-gen-additional-accessibility">Additional Accessibility Requirements:</label>
                    <textarea id="prompt-gen-additional-accessibility" name="additionalAccessibility" placeholder="Specify any additional accessibility features or compliance requirements..."></textarea>
                </div>
            </fieldset>

            <!-- OTHER -->
            <fieldset>
                <legend>Other</legend>
                <div>
                    <input type="checkbox" id="prompt-gen-specific-styling" name="specificStyling">
                    <label for="prompt-gen-specific-styling" class="prompt-gen-inline-label">Make code very specific (override theme styles)?</label>
                    <p class="prompt-gen-field-note">If yes, all standard HTML tags (p, h1-h4, select, input, form, button etc.) within the generated container will be explicitly styled, and all elements will get specific class names.</p>
                </div>
                <div>
                    <input type="checkbox" id="prompt-gen-add-important" name="addImportant">
                    <label for="prompt-gen-add-important" class="prompt-gen-inline-label">Add "!important" to all CSS rules (unless it would conflict with JS functionality)</label>
                </div>
                <div>
                    <input type="checkbox" id="prompt-gen-set-class-name-prefix" name="setClassNamePrefix">
                    <label for="prompt-gen-set-class-name-prefix" class="prompt-gen-inline-label">Set a class name prefix?</label>
                </div>
                <div id="prompt-gen-class-name-prefix-option" class="prompt-gen-sub-options prompt-gen-hidden">
                    <label for="prompt-gen-class-name-prefix-input">Class Name Prefix:</label>
                    <input type="text" id="prompt-gen-class-name-prefix-input" name="classNamePrefixInput" placeholder="e.g., my-component-">
                </div>
                <div>
                    <label>Code Comments Level:</label>
                    <div class="prompt-gen-radio-group">
                        <input type="radio" id="prompt-gen-comments-none" name="commentsLevel" value="none" checked>
                        <label for="prompt-gen-comments-none">No comments</label>
                        <input type="radio" id="prompt-gen-comments-succinct" name="commentsLevel" value="succinct">
                        <label for="prompt-gen-comments-succinct">Succinct comments</label>
                        <input type="radio" id="prompt-gen-comments-extensive" name="commentsLevel" value="extensive">
                        <label for="prompt-gen-comments-extensive">Extensive comments</label>
                    </div>
                </div>
            </fieldset>
            
            <!-- PROFILE MANAGEMENT -->
            <fieldset>
                <legend>Profile Management</legend>
                <button type="button" id="prompt-gen-save-profile-button" style="margin-bottom: 10px;">Save Profile (JSON)</button>
                <label for="prompt-gen-load-profile-input" style="display: block; margin-top: 10px;">Load Profile (JSON):</label>
                <input type="file" id="prompt-gen-load-profile-input" accept=".json">
            </fieldset>

            <button type="button" id="prompt-gen-generate-button">Generate Prompt</button>
        </form>

        <div id="prompt-gen-output-container" class="prompt-gen-hidden">
            <div class="prompt-gen-output-header">
                <h2>Generated Prompt</h2>
                <button id="prompt-gen-copy-button" class="prompt-gen-copy-button">Copy Prompt</button>
            </div>
            <pre id="prompt-gen-output"></pre>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const form = document.getElementById('prompt-gen-form');

            // --- START: Element Selectors ---
            const purposeSelect = document.getElementById('prompt-gen-purpose');
            const wordpressOptions = document.getElementById('prompt-gen-wordpress-options');
            const emailOptions = document.getElementById('prompt-gen-email-options');
            
            const generalStyleRadios = document.querySelectorAll('input[name="generalStyle"]');
            const generalStyleOtherText = document.getElementById('prompt-gen-style-other-text');

            const defineColorCheckbox = document.getElementById('prompt-gen-define-color');
            const colorOptions = document.getElementById('prompt-gen-color-options');
            const defineFontCheckbox = document.getElementById('prompt-gen-define-font');
            const fontOptions = document.getElementById('prompt-gen-font-options');
            
            const paletteChoiceRadios = document.querySelectorAll('input[name="paletteChoice"]');
            const mainAccentColor = document.getElementById('prompt-gen-main-accent-color');
            const secondaryAccentColor = document.getElementById('prompt-gen-secondary-accent-color');
            const textColorInput = document.getElementById('prompt-gen-text-color');
            const singleColorForPaletteInput = document.getElementById('prompt-gen-single-color-for-palette');

            const fontChoiceSelect = document.getElementById('prompt-gen-font-choice');
            const googleFontOptions = document.getElementById('prompt-gen-google-font-options');
            const allowFontAwesomeCheckbox = document.getElementById('prompt-gen-allow-font-awesome');
            const fontAwesomeImportOption = document.getElementById('prompt-gen-font-awesome-import-option');

            // Composition Elements
            const headerSection = document.getElementById('prompt-gen-header-section');
            const headerTypeSelect = document.getElementById('prompt-gen-header-type');
            const headerImageOptions = document.getElementById('prompt-gen-header-image-options');
            const imageSourceRadios = document.querySelectorAll('input[name="imageSource"]');
            const headerImageUrlInput = document.getElementById('prompt-gen-header-image-url-input');
            
            const logoOptionsContainer = document.getElementById('prompt-gen-logo-options-container');
            const logoChoiceRadios = document.querySelectorAll('input[name="logoChoice"]');
            const logoUrlInput = document.getElementById('prompt-gen-logo-url-input');

            const siteMenuOptionsContainer = document.getElementById('prompt-gen-site-menu-options-container');
            const siteMenuTypeSelect = document.getElementById('prompt-gen-site-menu-type');
            const siteMenuInstructionsTextarea = document.getElementById('prompt-gen-site-menu-instructions');

            const internalMenuContainer = document.getElementById('prompt-gen-internal-menu-container');
            const tocTypeSelect = document.getElementById('prompt-gen-toc-type');

            const picturesSection = document.getElementById('prompt-gen-pictures-section');
            const includePicturesCheckbox = document.getElementById('prompt-gen-include-pictures');
            const picturesOptions = document.getElementById('prompt-gen-pictures-options');
            const picturesSourceRadios = document.querySelectorAll('input[name="picturesSource"]');
            const picturesPlaceholderOptions = document.getElementById('prompt-gen-pictures-placeholder-options');
            const picturesUrlOptions = document.getElementById('prompt-gen-pictures-url-options');
            const lightboxWpNote = document.getElementById('prompt-gen-lightbox-wp-note');

            const sliderSection = document.getElementById('prompt-gen-slider-section');
            const includeSliderCheckbox = document.getElementById('prompt-gen-include-slider');
            const sliderOptions = document.getElementById('prompt-gen-slider-options');
            const sliderContentSourceRadios = document.querySelectorAll('input[name="sliderContentSource"]');
            const sliderPlaceholderOptions = document.getElementById('prompt-gen-slider-placeholder-options');
            const sliderUrlOptions = document.getElementById('prompt-gen-slider-url-options');
            
            const gallerySection = document.getElementById('prompt-gen-gallery-section');
            const includeGalleryCheckbox = document.getElementById('prompt-gen-include-gallery');
            const galleryOptions = document.getElementById('prompt-gen-gallery-options');
            const galleryContentSourceRadios = document.querySelectorAll('input[name="galleryContentSource"]');
            const galleryPlaceholderOptions = document.getElementById('prompt-gen-gallery-placeholder-options');
            const galleryUrlOptions = document.getElementById('prompt-gen-gallery-url-options');

            const listFormattingSection = document.getElementById('prompt-gen-list-formatting-section');
            
            // Text options
            const textTreatmentRadios = document.querySelectorAll('input[name="textTreatment"]');
            const textStyleOptions = document.getElementById('prompt-gen-text-style-options');
            const additionalTextInstructionsContainer = document.getElementById('prompt-gen-additional-text-instructions-container');
            
            // Other options
            const setClassNamePrefixCheckbox = document.getElementById('prompt-gen-set-class-name-prefix');
            const classNamePrefixOption = document.getElementById('prompt-gen-class-name-prefix-option');
            // --- END: Element Selectors ---


            // Color picker value displays
            const colorPickers = [
                {input: singleColorForPaletteInput, display: document.getElementById('prompt-gen-single-color-value')},
                {input: mainAccentColor, display: document.getElementById('prompt-gen-main-accent-value')},
                {input: secondaryAccentColor, display: document.getElementById('prompt-gen-secondary-accent-value')},
                {input: textColorInput, display: document.getElementById('prompt-gen-text-color-value')}
            ];

            colorPickers.forEach(picker => {
                if (picker.input && picker.display) { 
                    picker.input.addEventListener('input', () => {
                        picker.display.textContent = picker.input.value;
                    });
                }
            });

            function toggleElement(element, show) {
                if (element) element.classList.toggle('prompt-gen-hidden', !show);
            }

            function toggleDisabled(elements, disable) {
                (Array.isArray(elements) ? elements : [elements]).forEach(el => {
                    if (el) el.disabled = disable;
                });
            }
            
            // --- START: Event Listeners for UI changes ---
            if (purposeSelect) {
                purposeSelect.addEventListener('change', () => {
                    const selectedPurposeValue = purposeSelect.value;
                    
                    // Wordpress/Email specific dropdowns
                    toggleElement(wordpressOptions, selectedPurposeValue === 'wordpress');
                    toggleElement(emailOptions, selectedPurposeValue === 'email');
                    
                    // Lightbox WP Note
                    toggleElement(lightboxWpNote, selectedPurposeValue === 'wordpress' && includePicturesCheckbox.checked && document.getElementById('prompt-gen-pictures-lightbox').checked);
                    
                    // Header Section (standard one)
                    const isFullSiteOrApp = selectedPurposeValue === 'full_website' || selectedPurposeValue === 'web_app';
                    toggleElement(headerSection, !isFullSiteOrApp); // Hide standard header for full site/app
                    if (isFullSiteOrApp) { 
                        if(headerTypeSelect) headerTypeSelect.value = 'no'; 
                        toggleElement(headerImageOptions, false); 
                        toggleElement(headerImageUrlInput, false); 
                         if(document.getElementById('prompt-gen-image-placeholder')) { 
                            document.getElementById('prompt-gen-image-placeholder').checked = true;
                        }
                    }

                    // Logo Options
                    const showLogoOptions = selectedPurposeValue === 'full_website' || selectedPurposeValue === 'web_app' || selectedPurposeValue === 'email';
                    toggleElement(logoOptionsContainer, showLogoOptions);
                    if (!showLogoOptions) {
                        document.getElementById('prompt-gen-logo-no').checked = true;
                        toggleElement(logoUrlInput, false);
                    } else {
                        // Trigger change on logo choice to ensure URL input visibility is correct
                        const checkedLogoChoice = document.querySelector('input[name="logoChoice"]:checked');
                        if(checkedLogoChoice) checkedLogoChoice.dispatchEvent(new Event('change', {bubbles:true}));
                    }

                    // Site Menu Options
                    const showSiteMenuOptions = selectedPurposeValue === 'full_website' || selectedPurposeValue === 'web_app';
                    toggleElement(siteMenuOptionsContainer, showSiteMenuOptions);
                    if (!showSiteMenuOptions) {
                        if(siteMenuTypeSelect) siteMenuTypeSelect.value = 'none';
                        if(siteMenuInstructionsTextarea) siteMenuInstructionsTextarea.value = '';
                    }

                    // Internal Menu/TOC
                    const showInternalMenu = selectedPurposeValue === 'wordpress' || selectedPurposeValue === 'web_page';
                    toggleElement(internalMenuContainer, showInternalMenu);
                    if (!showInternalMenu && tocTypeSelect) {
                        tocTypeSelect.value = 'no';
                    }
                    
                    // Composition element visibility based on purpose
                    const isGeneralHtmlCssJs = selectedPurposeValue === 'html_css_js';
                    const isEmailPurpose = selectedPurposeValue === 'email';

                    // Slider: hidden for general and email
                    const showSlider = !isGeneralHtmlCssJs && !isEmailPurpose;
                    toggleElement(sliderSection, showSlider);
                    if (!showSlider) {
                        if (includeSliderCheckbox) includeSliderCheckbox.checked = false;
                        toggleElement(sliderOptions, false); // Also hide sub-options
                    }
                    
                    // Gallery: hidden for general and email
                    const showGallery = !isGeneralHtmlCssJs && !isEmailPurpose;
                    toggleElement(gallerySection, showGallery);
                    if (!showGallery) {
                        if (includeGalleryCheckbox) includeGalleryCheckbox.checked = false;
                        toggleElement(galleryOptions, false); // Also hide sub-options
                    }

                    // For general HTML/CSS/JS, specific composition elements are shown/hidden
                    // Header (headerSection) is handled by isFullSiteOrApp logic above
                    // Pictures (picturesSection) is always available
                    // List Formatting (listFormattingSection) is always available
                    // Internal Menu (internalMenuContainer) handled by its own wordpress/web_page logic
                });
            }


            generalStyleRadios.forEach(radio => {
                radio.addEventListener('change', () => {
                    const otherRadio = document.getElementById('prompt-gen-style-other');
                    if (otherRadio && generalStyleOtherText) {
                        if (otherRadio.checked) {
                            generalStyleOtherText.style.display = 'inline-block';
                            generalStyleOtherText.focus();
                        } else {
                            generalStyleOtherText.style.display = 'none';
                            generalStyleOtherText.value = ''; 
                        }
                    }
                });
            });

            if (defineColorCheckbox) {
                defineColorCheckbox.addEventListener('change', (e) => {
                    toggleElement(colorOptions, e.target.checked);
                });
            }

            if (defineFontCheckbox) {
                defineFontCheckbox.addEventListener('change', (e) => {
                    toggleElement(fontOptions, e.target.checked);
                });
            }

            paletteChoiceRadios.forEach(radio => {
                radio.addEventListener('change', () => {
                    const modelGenerates = document.getElementById('prompt-gen-model-palette').checked;
                    toggleDisabled([mainAccentColor, secondaryAccentColor, textColorInput], modelGenerates);
                    toggleDisabled(singleColorForPaletteInput, !modelGenerates);
                    // Ensure manual color inputs sub-options visibility based on "Define manually" radio
                    const manualColorInputs = document.getElementById('prompt-gen-manual-color-inputs');
                    toggleElement(manualColorInputs, !modelGenerates);

                });
            });
             // Initialize manual color inputs visibility
            if (document.getElementById('prompt-gen-model-palette')) {
                 toggleElement(document.getElementById('prompt-gen-manual-color-inputs'), !document.getElementById('prompt-gen-model-palette').checked);
            }


            if (fontChoiceSelect) {
                fontChoiceSelect.addEventListener('change', (e) => {
                    toggleElement(googleFontOptions, e.target.value === 'google');
                });
            }
            
            if (allowFontAwesomeCheckbox) {
                allowFontAwesomeCheckbox.addEventListener('change', (e) => {
                     toggleElement(fontAwesomeImportOption, e.target.checked);
                });
            }

            if (headerTypeSelect) {
                headerTypeSelect.addEventListener('change', (e) => {
                    const showImageOptions = e.target.value === 'hero_image';
                    toggleElement(headerImageOptions, showImageOptions);
                    if (!showImageOptions) { 
                         toggleElement(headerImageUrlInput, false);
                         if(document.getElementById('prompt-gen-image-placeholder')) document.getElementById('prompt-gen-image-placeholder').checked = true;
                    } else { 
                        const imageURLRadio = document.getElementById('prompt-gen-image-url');
                        if (imageURLRadio) toggleElement(headerImageUrlInput, imageURLRadio.checked);
                    }
                });
            }

            imageSourceRadios.forEach(radio => {
                radio.addEventListener('change', () => {
                    const imageUrlRadio = document.getElementById('prompt-gen-image-url');
                    if (imageUrlRadio) {
                        toggleElement(headerImageUrlInput, imageUrlRadio.checked);
                         if(imageUrlRadio.checked) headerImageUrlInput.focus(); else headerImageUrlInput.value = '';
                    }
                });
            });
            
            logoChoiceRadios.forEach(radio => {
                radio.addEventListener('change', () => {
                    const isUrlChoice = document.getElementById('prompt-gen-logo-url').checked;
                    toggleElement(logoUrlInput, isUrlChoice);
                    if(isUrlChoice) logoUrlInput.focus(); else logoUrlInput.value = '';
                });
            });


            if (includePicturesCheckbox) {
                includePicturesCheckbox.addEventListener('change', (e) => {
                    toggleElement(picturesOptions, e.target.checked);
                    // Update WP lightbox note visibility
                    const selectedPurposeValue = purposeSelect ? purposeSelect.value : 'html_css_js';
                    toggleElement(lightboxWpNote, selectedPurposeValue === 'wordpress' && e.target.checked && document.getElementById('prompt-gen-pictures-lightbox').checked);
                });
            }
            if(document.getElementById('prompt-gen-pictures-lightbox')) {
                document.getElementById('prompt-gen-pictures-lightbox').addEventListener('change', (e) => {
                     const selectedPurposeValue = purposeSelect ? purposeSelect.value : 'html_css_js';
                     toggleElement(lightboxWpNote, selectedPurposeValue === 'wordpress' && includePicturesCheckbox.checked && e.target.checked);
                });
            }
            
            picturesSourceRadios.forEach(radio => {
                radio.addEventListener('change', () => {
                    const isUrlSource = document.getElementById('prompt-gen-pictures-url').checked;
                    toggleElement(picturesPlaceholderOptions, !isUrlSource);
                    toggleElement(picturesUrlOptions, isUrlSource);
                    if(isUrlSource) document.getElementById('prompt-gen-pictures-urls').focus(); else document.getElementById('prompt-gen-pictures-urls').value = '';
                });
            });

            if (includeSliderCheckbox) {
                includeSliderCheckbox.addEventListener('change', (e) => {
                    toggleElement(sliderOptions, e.target.checked);
                });
            }
            
            sliderContentSourceRadios.forEach(radio => {
                radio.addEventListener('change', () => {
                    const isUrlSource = document.getElementById('prompt-gen-slider-url').checked;
                    toggleElement(sliderPlaceholderOptions, !isUrlSource);
                    toggleElement(sliderUrlOptions, isUrlSource);
                     if(isUrlSource) document.getElementById('prompt-gen-slider-urls').focus(); else document.getElementById('prompt-gen-slider-urls').value = '';
                });
            });
            
            if (includeGalleryCheckbox) {
                includeGalleryCheckbox.addEventListener('change', (e) => {
                    toggleElement(galleryOptions, e.target.checked);
                });
            }
            
            galleryContentSourceRadios.forEach(radio => {
                radio.addEventListener('change', () => {
                    const isUrlSource = document.getElementById('prompt-gen-gallery-url').checked;
                    toggleElement(galleryPlaceholderOptions, !isUrlSource);
                    toggleElement(galleryUrlOptions, isUrlSource);
                    if(isUrlSource) document.getElementById('prompt-gen-gallery-urls').focus(); else document.getElementById('prompt-gen-gallery-urls').value = '';
                });
            });

            textTreatmentRadios.forEach(radio => {
                radio.addEventListener('change', () => {
                    const improveStylingRadio = document.getElementById('prompt-gen-text-improve-styling');
                    const doNotSpecifyRadio = document.getElementById('prompt-gen-text-do-not-specify');

                    if (doNotSpecifyRadio.checked) {
                        toggleElement(textStyleOptions, false);
                        toggleElement(additionalTextInstructionsContainer, false);
                    } else {
                        toggleElement(textStyleOptions, improveStylingRadio.checked);
                        toggleElement(additionalTextInstructionsContainer, true);
                    }
                });
            });

            if (setClassNamePrefixCheckbox) {
                setClassNamePrefixCheckbox.addEventListener('change', (e) => {
                    toggleElement(classNamePrefixOption, e.target.checked);
                    if(e.target.checked) document.getElementById('prompt-gen-class-name-prefix-input').focus(); else document.getElementById('prompt-gen-class-name-prefix-input').value = '';
                });
            }
            // --- END: Event Listeners for UI changes ---

            function processFullHtmlReference(htmlString) {
                const parser = new DOMParser();
                const doc = parser.parseFromString(htmlString, 'text/html');
                let bodyHtml = '';
                if (doc.body) {
                    const tempBody = doc.body.cloneNode(true); 
                    tempBody.querySelectorAll('script').forEach(script => script.remove());
                    bodyHtml = tempBody.innerHTML;
                }
                let styleTagContent = '';
                doc.querySelectorAll('style').forEach(styleElement => {
                    styleTagContent += styleElement.innerHTML.trim() + '\n\n/* --- End of a style block --- */\n\n';
                });
                return {
                    processedBodyHtml: bodyHtml.trim(),
                    extractedStyleTagContent: styleTagContent.trim()
                };
            }

            const copyButton = document.getElementById('prompt-gen-copy-button');
            const outputElement = document.getElementById('prompt-gen-output');
            if (copyButton && outputElement) {
                copyButton.addEventListener('click', function() {
                    if (outputElement.textContent) {
                        navigator.clipboard.writeText(outputElement.textContent)
                            .then(() => {
                                const originalText = copyButton.textContent;
                                copyButton.textContent = 'Copied!';
                                setTimeout(() => { copyButton.textContent = originalText; }, 2000);
                            })
                            .catch(err => {
                                console.error('Failed to copy: ', err);
                                alert('Failed to copy to clipboard. Please try again or manually select and copy the text.');
                            });
                    }
                });
            }

            const generateButton = document.getElementById('prompt-gen-generate-button');
            const outputContainer = document.getElementById('prompt-gen-output-container');
            if (generateButton && outputContainer && outputElement) {
                generateButton.addEventListener('click', () => {
                    const data = {};
                    for (const element of form.elements) {
                        if (!element.name) continue; 

                        const name = element.name;
                        switch (element.type) {
                            case 'checkbox':
                                data[name] = element.checked;
                                break;
                            case 'radio':
                                if (element.checked) {
                                    data[name] = element.value;
                                }
                                break;
                            default: 
                                data[name] = element.value;
                                break;
                        }
                    }

                    let prompt = "Generate code based on the following specifications that were generated from a form filled in by a person. Follow each instruction carefully and balance all requirements to create the best possible solution:\n\n";
                    
                    prompt += "## PURPOSE OF CODE GENERATION:\n";
                    const purpose = data.purpose;
                    if (purpose === 'html_css_js') prompt += "- Type: General HTML, CSS, and JavaScript (if JS is necessary/useful) component/snippet.\n";
                    if (purpose === 'wordpress') {
                        prompt += `- Type: Wordpress Element (${data.wordpressType}).\n`;
                        prompt += "- Instruction: Output a single block of code suitable for a WordPress custom HTML widget or block. Exclude <html>, <head>, <body> tags etc. as they are not needed here. The code should work within the WordPress ecosystem and follow WordPress coding best practices.\n";
                    }
                    if (purpose === 'email') {
                        prompt += `- Type: Email (${data.emailType}).\n`;
                        prompt += "- Instruction: Ensure compatibility with major email clients. Use inline CSS and table-based layouts where appropriate for maximum compatibility. Avoid advanced CSS features that are inconsistently supported in email clients.\n";
                    }
                    if (purpose === 'full_website' || purpose === 'web_app') {
                        prompt += `- Type: ${purpose === 'full_website' ? 'Full Website' : 'Full Web App'}.\n`;
                        prompt += "- Instruction: Include complete structure with semantically correct HTML5 tags. Create relevant SEO meta tags in the <head> (title, description, keywords) derived from the provided content. Structure for good SEO practices (semantic HTML, logical heading structure). Ensure all necessary components for a complete site solution.\n";
                    }
                     if (purpose === 'web_page') {
                        prompt += "- Type: Web Page for an existing website.\n";
                        prompt += "- Instruction: Generate the content for the <body> tag that can be inserted into an existing site. Create self-contained styles that won't conflict with parent site. If SEO aspects are relevant for this specific page, consider how to advise on title/meta description based on content.\n";
                    }
                    if (data.summary && data.summary.trim() !== '') {
                        prompt += `- Summary of what to create: ${data.summary.trim()}\n`;
                    }
                    prompt += "\n";

                    prompt += "## STYLING:\n";
                    
                    let generalStyleValue = data.generalStyle;
                    if (data.generalStyle === 'other' && data.generalStyleOtherText && data.generalStyleOtherText.trim() !== '') {
                        generalStyleValue = `Other: ${data.generalStyleOtherText.trim()}`;
                    } else if (data.generalStyle === 'other') {
                        generalStyleValue = 'Other (not specified, use your best judgement or a neutral style)';
                    }
                    prompt += `- General Style: ${generalStyleValue}.\n`;

                    if (data.generalStyle && data.generalStyle !== 'other') {
                        prompt += `  - For "${data.generalStyle}" style, here's what that means:\n`;
                        if (data.generalStyle === 'modern') {
                            prompt += `    - Clean, minimalist approach with ample whitespace\n    - Subtle shadows and rounded corners where appropriate\n    - Smooth transitions/animations for interactive elements\n    - Contemporary typography with good readability\n    - Flat design elements with subtle depth cues\n`;
                        } else if (data.generalStyle === 'retro') {
                            prompt += `    - Nostalgic design elements from a specific era (70s, 80s, 90s, etc.)\n    - Typography characteristic of the period\n    - Color schemes reminiscent of vintage design\n    - Possibly include design artifacts like mild distressing or analog-inspired elements\n`;
                        } else if (data.generalStyle === 'visually_striking') {
                            prompt += `    - Bold, high-contrast design elements\n    - Attention-grabbing typography or color combinations\n    - Creative layout that catches the eye\n    - May include unusual or unexpected visual elements\n    - Strong visual hierarchy to direct attention\n`;
                        } else if (data.generalStyle === 'professional') {
                            prompt += `    - Clean, business-appropriate aesthetics\n    - Subdued color palette with strategic accent colors\n    - Consistent, organized layout structure\n    - Typography focused on clarity and readability\n    - Polished, refined interactive elements\n`;
                        }
                    } else if (data.generalStyle === 'other' && data.generalStyleOtherText && data.generalStyleOtherText.trim() !== '') {
                         prompt += `  - For "Other: ${data.generalStyleOtherText.trim()}" style, interpret and apply the user's specified style.\n`;
                    }
                    
                    if (data.additionalStyle && data.additionalStyle.trim() !== '') {
                        prompt += `- Additional Style Instructions: ${data.additionalStyle.trim()}.\n`;
                    }


                    if (data.referenceCode && data.referenceCode.trim() !== '') {
                        const refCode = data.referenceCode.trim();
                        if (refCode.toLowerCase().includes('<html') && (refCode.toLowerCase().includes('<body') || refCode.toLowerCase().includes('</head>'))) {
                            const processed = processFullHtmlReference(refCode);
                            prompt += `- Reference "View Source" Output Provided:\n`;
                            if (processed.extractedStyleTagContent) {
                                prompt += `  - Internal CSS from <style> tags (from head and body):\n\`\`\`css\n${processed.extractedStyleTagContent}\n\`\`\`\n`;
                            } else {
                                prompt += `  - No internal <style> tags found or extracted from the reference.\n`;
                            }
                            if (processed.processedBodyHtml) {
                                prompt += `  - Body HTML Structure (scripts removed, other non-renderable head elements like meta/link are excluded from this body extraction):\n\`\`\`html\n${processed.processedBodyHtml}\n\`\`\`\n`;
                            } else {
                                prompt += `  - Body HTML could not be reliably extracted from the reference.\n`;
                            }
                            prompt += `  - LLM Instruction for this reference: Analyze the provided HTML structure and any accompanying internal CSS as a strong style reference. Focus on elements likely visible on a page: their colors, fonts, spacing, layout tendencies, and overall component appearance. Be aware that styles from external stylesheets (<link rel="stylesheet">) and JavaScript-applied styles are NOT included in this extraction. Infer the overall style and apply it to the new code you generate.\n`;
                        } else {
                            prompt += `- Reference Code Snippet Provided: Yes. Analyze the following code for style (colors, fonts, layout tendencies, component styling) and apply similar styling. This could be HTML, CSS, or a mix. Extract key style elements rather than a wholesale copy.\n\`\`\`\n${refCode}\n\`\`\`\n`;
                        }
                    } else {
                        prompt += "- No reference code provided. Create styling based on the instructions above/below.\n";
                    }

                    if (data.defineColor) {
                        prompt += "- Custom Colors Defined:\n";
                        if (data.paletteChoice === 'model_generates') {
                            prompt += `  - Palette: Generate a harmonious color palette based on the primary color: ${data.singleColorForPalette}.\n`;
                            prompt += `  - Create a coordinated scheme with appropriate complementary and accent colors.\n`;
                            prompt += `  - Text Color: Choose an appropriate text color for readability against the generated palette, ensuring WCAG AA or better contrast ratios.\n`;
                        } else {
                            prompt += `  - Main Accent Color: ${data.mainAccentColor} - Use for primary UI elements and key visual anchors.\n`;
                            prompt += `  - Secondary Accent Color: ${data.secondaryAccentColor} - Use for supporting elements, highlights, or to create visual interest.\n`;
                            prompt += `  - Text Color: ${data.textColor} - Use for main body text and ensure appropriate contrast with background elements.\n`;
                        }
                    }

                    if (data.defineFont) {
                        prompt += "- Custom Fonts Defined:\n";
                        prompt += `  - Font Choice: ${data.fontChoice}.\n`;
                        if (data.fontChoice === 'standard') {
                            prompt += `    - Use widely-supported system fonts like Arial, Helvetica, Verdana, etc. Consider using modern font stacks for better typography.\n`;
                        }
                        if (data.fontChoice === 'google' && data.googleFontName && data.googleFontName.trim() !== '') {
                            prompt += `    - Google Font(s): ${data.googleFontName.trim()}.\n`;
                            if (data.includeGoogleFontImport) {
                                prompt += "    - Instruction: Include CSS @import or <link> tag for the specified Google Font(s). Use the most efficient way to load these fonts.\n";
                            }
                        }
                        if (data.allowFontAwesome) {
                            prompt += "  - Font Awesome: Allowed.\n";
                            prompt += "    - You may use Font Awesome icons where appropriate to enhance the design.\n";
                            if (data.importFontAwesome) {
                                prompt += "    - Instruction: If Font Awesome icons are used, include the necessary CDN link for Font Awesome (prefer the latest version).\n";
                            }
                        } else {
                            prompt += "  - Font Awesome: Not allowed. Use alternative methods for icons if needed (SVG, Unicode, etc.).\n";
                        }
                    }
                    prompt += "\n";

                    prompt += "## COMPOSITION / ELEMENTS:\n";
                    let compositionSpecified = false;
                    const isFullSiteOrApp = purpose === 'full_website' || purpose === 'web_app';
                    
                    // Standard Header (not for full_website/web_app)
                    if (!isFullSiteOrApp && data.headerType !== 'no') {
                        compositionSpecified = true;
                        prompt += `- Header/Title: ${data.headerType}.\n`;
                        if (data.headerType === 'title_only') {
                            prompt += `  - Include a simple, well-styled title element appropriate for the purpose and content.\n`;
                        } else if (data.headerType === 'simple_header') {
                            prompt += `  - Create a header section with title and potentially supporting elements like subtitles or navigation as appropriate.\n`;
                        } else if (data.headerType === 'hero_image') {
                            prompt += `  - Create a hero section with title overlaid on a background image.\n`;
                            prompt += `  - Hero Image Source: ${data.imageSource}.\n`;
                            if (data.imageSource === 'url' && data.headerImageUrlInput && data.headerImageUrlInput.trim() !== '') {
                                prompt += `    - Image URL: ${data.headerImageUrlInput.trim()}.\n`;
                            } else {
                                prompt += `    - Image URL: Use a relevant placeholder image (e.g., from placeholder.com or similar, with appropriate dimensions). Suggest a specific placeholder that would work well for the content.\n`;
                            }
                        }
                    }

                    // Logo (for full_website, web_app, email)
                    const showLogoOptions = purpose === 'full_website' || purpose === 'web_app' || purpose === 'email';
                    if (showLogoOptions && data.logoChoice && data.logoChoice !== 'no') {
                        compositionSpecified = true;
                        prompt += "- Logo:\n";
                        if (data.logoChoice === 'placeholder') {
                            prompt += "  - Include a placeholder logo suitable for the design.\n";
                        } else if (data.logoChoice === 'url' && data.logoUrlInput && data.logoUrlInput.trim() !== '') {
                            prompt += `  - Use logo from URL: ${data.logoUrlInput.trim()}\n`;
                        } else if (data.logoChoice === 'url') {
                             prompt += "  - User selected 'Provide Logo URL' but did not provide a URL. If a logo is critical, use a placeholder or note its absence.\n";
                        }
                    }
                    
                    // Main Navigation Menu (for full_website, web_app)
                    const showSiteMenuOptions = purpose === 'full_website' || purpose === 'web_app';
                    if (showSiteMenuOptions && data.siteMenuType && data.siteMenuType !== 'none') {
                        compositionSpecified = true;
                        prompt += `- Main Navigation Menu:\n`;
                        prompt += `  - Style: ${data.siteMenuType.replace(/_/g, ' ')}.\n`;
                        if (data.siteMenuInstructions && data.siteMenuInstructions.trim() !== '') {
                            prompt += `  - Additional Instructions: ${data.siteMenuInstructions.trim()}\n`;
                        }
                    }
                    
                    // Internal Menu/TOC (for wordpress, web_page)
                    const showInternalMenu = purpose === 'wordpress' || purpose === 'web_page';
                    if (showInternalMenu && data.tocType !== 'no') {
                        compositionSpecified = true;
                        prompt += `- Internal Menu/TOC: ${data.tocType}. Base on heading IDs if applicable.\n`;
                        if (data.tocType === 'top') {
                            prompt += `  - Create a table of contents/internal navigation menu positioned at the top of the content.\n`;
                        } else if (data.tocType === 'top_scrolling') {
                            prompt += `  - Create a table of contents/internal navigation menu that remains visible as the user scrolls down.\n`;
                        } else if (data.tocType === 'floating_left') {
                            prompt += `  - Create a floating table of contents/internal navigation menu positioned on the left side.\n`;
                        }
                    }
                    
                    // Pictures (always available to choose)
                    if (data.includePictures) {
                        compositionSpecified = true;
                        prompt += `- Pictures: Include pictures/images.\n`;
                        prompt += `  - Source: ${data.picturesSource === 'placeholder' ? 'Use placeholder images' : 'Use provided URLs'}.\n`;
                        if (data.picturesSource === 'placeholder') {
                            prompt += `  - Number of placeholders: ${data.picturesPlaceholderCount}.\n`;
                        } else if (data.picturesUrls && data.picturesUrls.trim() !== '') {
                            const urls = data.picturesUrls.trim().split('\n').filter(url => url.trim() !== '');
                            prompt += `  - Image URLs (${urls.length}):\n`;
                            urls.forEach(url => { prompt += `    - ${url.trim()}\n`; });
                        }
                        prompt += `  - Display Method: ${data.picturesDisplayMethod === 'as_is' ? 'Add as regular images' : 'Use as background in styled frames'}.\n`;
                        if (data.picturesLightbox) {
                            prompt += `  - Include lightbox functionality: Yes.\n`;
                             if (purpose === 'wordpress') {
                                prompt += `    - Note: For WordPress, if a native solution is preferred, you can skip implementing custom JS for lightbox but ensure images are set up to work with WP's lightbox.\n`;
                            }
                        }
                    }
                    
                    // Slider (not for general html/css/js or email)
                    const showSlider = purpose !== 'html_css_js' && purpose !== 'email';
                    if (showSlider && data.includeSlider) {
                        compositionSpecified = true;
                        prompt += `- Slider: Include a slider.\n`;
                        prompt += `  - Type: ${data.sliderType}.\n`;
                        prompt += `  - Content Source: ${data.sliderContentSource === 'placeholder' ? 'Use placeholder images' : 'Use provided URLs'}.\n`;
                        if (data.sliderContentSource === 'placeholder') {
                            prompt += `  - Number of slides: ${data.sliderPlaceholderCount}.\n`;
                        } else if (data.sliderUrls && data.sliderUrls.trim() !== '') {
                            const urls = data.sliderUrls.trim().split('\n').filter(url => url.trim() !== '');
                            prompt += `  - Slide Image URLs (${urls.length}):\n`;
                            urls.forEach(url => { prompt += `    - ${url.trim()}\n`; });
                        }
                        if (data.sliderInstructions && data.sliderInstructions.trim() !== '') {
                            prompt += `  - Custom Instructions: ${data.sliderInstructions.trim()}.\n`;
                        }
                    }
                    
                    // Gallery (not for general html/css/js or email)
                    const showGallery = purpose !== 'html_css_js' && purpose !== 'email';
                    if (showGallery && data.includeGallery) {
                        compositionSpecified = true;
                        prompt += `- Photo Gallery: Include a photo gallery.\n`;
                        prompt += `  - Type: ${data.galleryType}.\n`;
                        prompt += `  - Content Source: ${data.galleryContentSource === 'placeholder' ? 'Use placeholder images' : 'Use provided URLs'}.\n`;
                        if (data.galleryContentSource === 'placeholder') {
                            prompt += `  - Number of images: ${data.galleryPlaceholderCount}.\n`;
                        } else if (data.galleryUrls && data.galleryUrls.trim() !== '') {
                            const urls = data.galleryUrls.trim().split('\n').filter(url => url.trim() !== '');
                            prompt += `  - Gallery Image URLs (${urls.length}):\n`;
                            urls.forEach(url => { prompt += `    - ${url.trim()}\n`; });
                        }
                        if (data.galleryInstructions && data.galleryInstructions.trim() !== '') {
                            prompt += `  - Custom Instructions: ${data.galleryInstructions.trim()}.\n`;
                        }
                    }
                    
                    // Lists Formatting (always available to choose)
                    if (data.listFormat !== 'default') {
                        compositionSpecified = true;
                        prompt += `- Lists Formatting: ${data.listFormat}.\n`;
                        if (data.listCustomInstructions && data.listCustomInstructions.trim() !== '') {
                            prompt += `  - Custom List Instructions: ${data.listCustomInstructions.trim()}.\n`;
                        }
                    }
                    
                    if (!compositionSpecified) {
                        prompt += "- No specific pre-defined elements selected from the 'Composition' section. Refer to 'Content Instructions' for any element requirements.\n";
                    }
                    prompt += "\n";

                    prompt += "## CONTENT:\n";
                    if (data.contentInstructions && data.contentInstructions.trim() !== '') {
                        prompt += `- Main Content & Instructions:\n\`\`\`\n${data.contentInstructions.trim()}\n\`\`\`\n`;
                        prompt += "- IMPORTANT: If instructions in the 'Main Content & Instructions' section above conflict with choices/styles defined earlier, the 'Main Content & Instructions' take precedence.\n";
                    } else {
                        prompt += "- No specific content or detailed instructions provided. Generate placeholder content that's appropriate for the purpose and structure of the code.\n";
                    }
                    
                    if (data.textTreatment && data.textTreatment !== 'do_not_specify') {
                        prompt += `- Text Treatment: ${data.textTreatment.replace(/_/g, ' ')}.\n`;
                        if (data.textTreatment === 'preserve') {
                            prompt += `  - Explanation: Keep the exact wording provided. HTML formatting may be added, but the text itself should remain unchanged.\n`;
                        } else if (data.textTreatment === 'improve_mistakes') {
                            prompt += `  - Explanation: Correct obvious typos, grammatical errors, and formatting issues while preserving the overall message and tone.\n`;
                        } else if (data.textTreatment === 'improve_styling') {
                            prompt += `  - Explanation: Rephrase, restructure, and enhance the provided text for flow, clarity, and impact. Maintain core message.\n`;
                            prompt += `  - Desired Text Style/Tone: ${data.textStyleTone.replace(/_/g, ' ')}.\n`;
                            if (data.textStyleReference && data.textStyleReference.trim() !== '') {
                                prompt += `  - Text Style Reference (use for style/tone only):\n\`\`\`\n${data.textStyleReference.trim()}\n\`\`\`\n`;
                            }
                        }
                        if (data.additionalTextInstructions && data.additionalTextInstructions.trim() !== '') {
                             prompt += `- Additional Text Treatment Instructions:\n${data.additionalTextInstructions.trim()}\n`;
                        }
                    } else {
                        prompt += "- Text Treatment: Not specified by user. Use your best judgment based on the content context (e.g., preserve if it looks like specific copy, improve if it looks like rough notes).\n";
                    }
                    prompt += "\n";
                    
                    prompt += "## RESPONSIVENESS AND ACCESSIBILITY:\n";
                    if (data.mobileFirst) prompt += "- Use Mobile-First Design approach.\n";
                    else prompt += "- Use a standard responsive design approach.\n";
                    if (data.includeDarkMode) prompt += "- Include Dark Mode with system preference detection (prefers-color-scheme).\n";
                    if (data.includeHighContrast) prompt += "- Include High Contrast Mode option (e.g., via toggle or prefers-contrast).\n";
                    if (data.includeFontSizing) prompt += "- Include Font Size adjustment controls.\n";
                    if (data.ensureAria) prompt += "- Ensure proper ARIA attributes for accessibility.\n";
                    if (data.additionalAccessibility && data.additionalAccessibility.trim() !== '') {
                        prompt += `- Additional Accessibility Requirements:\n${data.additionalAccessibility.trim()}\n`;
                    }
                    prompt += "\n";

                    prompt += "## OTHER REQUIREMENTS:\n";
                    if (data.specificStyling) prompt += "- Style all standard HTML tags very specifically to override theme styles. All elements should get specific class names.\n";
                    if (data.addImportant) prompt += "- Add '!important' to CSS rules (unless conflicting with JS functionality).\n";
                    if (data.setClassNamePrefix) {
                        if (data.classNamePrefixInput && data.classNamePrefixInput.trim() !== '') {
                            prompt += `- Class Name Prefix: Use "${data.classNamePrefixInput.trim()}" for all CSS classes.\n`;
                        } else {
                            prompt += "- Use class names/IDs derived from content (user wanted prefix but didn't specify).\n";
                        }
                    } else {
                        prompt += "- Use class names/IDs derived from content.\n";
                    }
                    prompt += `- Code Comments Level: ${data.commentsLevel}.\n`;
                    prompt += "\n";
                    
                    prompt += "## FINAL OUTPUT EXPECTATIONS:\n";
                    prompt += "- Provide HTML, CSS, and JavaScript in a SINGLE code block unless the purpose dictates otherwise (e.g. WordPress might just be HTML/PHP with inline styles or enqueued assets).\n";
                    prompt += "- If CSS is separate, place it in <style> tags. If JS is separate, place it in <script> tags.\n";
                    prompt += "- Aim for accessible, responsive design following best practices.\n";
                    
                    outputElement.textContent = prompt;
                    toggleElement(outputContainer, true);
                    outputElement.scrollTop = 0; // Scroll to top of prompt
                });
            }

            const saveProfileButton = document.getElementById('prompt-gen-save-profile-button');
            const loadProfileInput = document.getElementById('prompt-gen-load-profile-input');

            if (saveProfileButton) {
                saveProfileButton.addEventListener('click', () => {
                    const profileData = {};
                    for (const element of form.elements) {
                        if (element.name) {
                            switch (element.type) {
                                case 'checkbox':
                                    profileData[element.name] = element.checked;
                                    break;
                                case 'radio':
                                    if (element.checked) {
                                        profileData[element.name] = element.value;
                                    }
                                    break;
                                default: 
                                    profileData[element.name] = element.value;
                                    break;
                            }
                        }
                    }

                    const jsonString = JSON.stringify(profileData, null, 2);
                    const blob = new Blob([jsonString], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    const date = new Date().toISOString().slice(0, 10);
                    a.href = url;
                    a.download = `Notes2LLM_Profile_${date}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                });
            }

            if (loadProfileInput) {
                loadProfileInput.addEventListener('change', (event) => {
                    const file = event.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            try {
                                const profileData = JSON.parse(e.target.result);
                                for (const name in profileData) {
                                    if (profileData.hasOwnProperty(name)) {
                                        const formElementOrNodeList = form.elements[name];
                                        const value = profileData[name];

                                        if (!formElementOrNodeList) {
                                            console.warn(`No form element found for profile key: ${name}`);
                                            continue;
                                        }

                                        if (formElementOrNodeList.constructor === RadioNodeList) { 
                                            formElementOrNodeList.forEach(radio => {
                                                radio.checked = (radio.value === value);
                                            });
                                        } else { 
                                            const element = formElementOrNodeList;
                                            if (element.type === 'checkbox') {
                                                element.checked = Boolean(value);
                                            } else { 
                                                element.value = value;
                                            }
                                        }
                                    }
                                }
                                updateDependentUI(); 
                                loadProfileInput.value = ''; 
                            } catch (error) {
                                console.error('Error parsing JSON profile:', error);
                                alert('Failed to load profile: Invalid JSON file.');
                                loadProfileInput.value = '';
                            }
                        };
                        reader.onerror = () => {
                            alert('Failed to read the profile file.');
                            loadProfileInput.value = '';
                        };
                        reader.readAsText(file);
                    }
                });
            }

            function updateDependentUI() {
                // Trigger change event for purpose select to update all dependent sections
                if (purposeSelect) purposeSelect.dispatchEvent(new Event('change', { bubbles: true }));

                // General Style "Other" text field
                const checkedGeneralStyleRadio = document.querySelector('input[name="generalStyle"]:checked');
                if (checkedGeneralStyleRadio) {
                    checkedGeneralStyleRadio.dispatchEvent(new Event('change', { bubbles: true }));
                } else if (generalStyleOtherText) { // Fallback if somehow no radio is checked
                     toggleElement(generalStyleOtherText, false); generalStyleOtherText.value = '';
                }

                // Colors
                if (defineColorCheckbox) defineColorCheckbox.dispatchEvent(new Event('change', { bubbles: true }));
                const checkedPaletteChoiceRadio = document.querySelector('input[name="paletteChoice"]:checked');
                if (checkedPaletteChoiceRadio) checkedPaletteChoiceRadio.dispatchEvent(new Event('change', { bubbles: true }));
                
                // Fonts
                if (defineFontCheckbox) defineFontCheckbox.dispatchEvent(new Event('change', { bubbles: true }));
                if (fontChoiceSelect) fontChoiceSelect.dispatchEvent(new Event('change', { bubbles: true }));
                if (allowFontAwesomeCheckbox) allowFontAwesomeCheckbox.dispatchEvent(new Event('change', { bubbles: true }));

                // Composition - Header related
                if (headerTypeSelect) headerTypeSelect.dispatchEvent(new Event('change', { bubbles: true }));
                // Image source radios within header are handled by headerTypeSelect change
                // Logo choice radios are handled by purposeSelect change initially

                // Composition - Pictures, Slider, Gallery checkboxes
                if (includePicturesCheckbox) includePicturesCheckbox.dispatchEvent(new Event('change', { bubbles: true }));
                // picturesSourceRadios are handled by includePicturesCheckbox change
                if (document.getElementById('prompt-gen-pictures-lightbox')) document.getElementById('prompt-gen-pictures-lightbox').dispatchEvent(new Event('change', {bubbles:true}));


                if (includeSliderCheckbox) includeSliderCheckbox.dispatchEvent(new Event('change', { bubbles: true }));
                // sliderContentSourceRadios are handled by includeSliderCheckbox change

                if (includeGalleryCheckbox) includeGalleryCheckbox.dispatchEvent(new Event('change', { bubbles: true }));
                // galleryContentSourceRadios are handled by includeGalleryCheckbox change
                
                // Text Treatment
                const checkedTextTreatmentRadio = document.querySelector('input[name="textTreatment"]:checked');
                if (checkedTextTreatmentRadio) checkedTextTreatmentRadio.dispatchEvent(new Event('change', { bubbles: true }));

                // Other
                if (setClassNamePrefixCheckbox) setClassNamePrefixCheckbox.dispatchEvent(new Event('change', { bubbles: true }));

                // Update color picker displays
                colorPickers.forEach(picker => {
                    if (picker.input && picker.display) {
                         picker.display.textContent = picker.input.value;
                    }
                });
            }
            
            // Initial UI setup based on default values
            updateDependentUI();
        });
    </script>
</body>
</html>